---
import { getCollection } from 'astro:content';

// 1. Fetch Projects from Keystatic/Astro Content
const allProjects = await getCollection('projects');

// 2. Sort & Slice (Optional: You can add logic to sort by 'Featured' later)
// For now, we take the first 3 projects.
const featuredProjects = allProjects.slice(0, 3);
---

<section id="properties" class="py-24 px-6 md:px-12 bg-white">
  <div class="max-w-7xl mx-auto">
    
    {/* SECTION HEADER */}
    <div class="flex flex-col md:flex-row justify-between items-start mb-16 gap-6">
      <div>
        <span class="text-xs font-bold tracking-[0.3em] text-amber-700 uppercase mb-4 block">
          Real Estate & Development
        </span>
        <h2 class="text-4xl md:text-6xl font-light tracking-tighter text-neutral-900 leading-[0.95]">
          Featured <span class="font-serif italic text-neutral-400">Properties</span>
        </h2>
      </div>
      
      <a href="/projects" class="group flex items-end gap-3 text-xs font-bold tracking-[0.2em] uppercase text-neutral-500 hover:text-amber-700 transition-colors">
        View All Listings
        <span class="group-hover:translate-x-1 transition-transform duration-300">â†’</span>
      </a>
    </div>

    {/* PROPERTIES GRID */}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      {featuredProjects.map((project) => (
        <a href={`/projects/${project.slug}`} class="group block relative">
          
          {/* IMAGE CARD */}
          <div class="aspect-[3/4] md:aspect-[4/5] overflow-hidden bg-neutral-100 relative mb-6">
            <img 
              src={project.data.coverImage} 
              alt={project.data.title}
              class="w-full h-full object-cover transition-transform duration-700 ease-[cubic-bezier(0.25,1,0.5,1)] group-hover:scale-105"
            />
            
            {/* OVERLAY: Darken slightly on hover */}
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors duration-500"></div>

            {/* STATUS BADGE (Top Left) */}
            <div class="absolute top-4 left-4 bg-white/95 backdrop-blur-sm px-3 py-1.5 text-[10px] uppercase tracking-widest font-bold text-amber-800 shadow-sm">
              {project.data.status}
            </div>
          </div>

          {/* TEXT INFO */}
          <div class="flex justify-between items-start border-t border-neutral-200 pt-4 group-hover:border-amber-700/30 transition-colors duration-500">
            <div>
              <h3 class="text-xl font-medium text-neutral-900 mb-1 group-hover:text-amber-800 transition-colors">
                {project.data.title}
              </h3>
              <p class="text-sm text-neutral-500 font-light flex items-center gap-2">
                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-Width="2" class="opacity-60">
                    <path d="M12 21s-8-4.5-8-11.8A8 8 0 0112 2a8 8 0 018 7.2c0 7.3-8 11.8-8 11.8z" />
                    <circle cx="12" cy="10" r="3" />
                </svg>
                {project.data.location}
              </p>
            </div>
            
            {/* YEAR / ARROW */}
            <div class="text-right">
               <span class="text-xs font-bold text-neutral-300 group-hover:text-amber-700 transition-colors duration-300">
                 {project.data.year}
               </span>
            </div>
          </div>

        </a>
      ))}
    </div>

  </div>
</section>